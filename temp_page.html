<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>使用者詳情 - Chi Soo 管理後台</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /*
        * STRICT RULE: DO NOT USE EMOJIS AS ICONS.
        * Always use FontAwesome icons (e.g., <i class="fa-solid fa-user"></i>).
        * Emojis look unprofessional and inconsistent across OS.
      */
      :root {
        --sidebar-bg: #1f2937;
        --sidebar-text: #9ca3af;
        --sidebar-text-hover: #ffffff;
        --main-bg: #f3f4f6;
        --card-bg: #ffffff;
        --text-primary: #111827;
        --text-secondary: #6b7280;
        --accent-blue: #3b82f6;
        --accent-green: #10b981;
        --accent-orange: #f59e0b;
        --accent-red: #ef4444;
        --input-border: #d1d5db;
        --input-focus: #3b82f6;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          "Segoe UI",
          system-ui,
          -apple-system,
          sans-serif;
        background-color: var(--main-bg);
        color: var(--text-primary);
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar */
      .sidebar {
        width: 250px;
        background-color: var(--sidebar-bg);
        color: var(--sidebar-text);
        display: flex;
        flex-direction: column;
        position: fixed;
        height: 100vh;
        left: 0;
        top: 0;
        z-index: 100;
      }
      .logo {
        padding: 20px;
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid #374151;
      }
      .nav-menu {
        padding: 20px 0;
        list-style: none;
        flex-grow: 1;
      }
      .nav-link {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: inherit;
        text-decoration: none;
        gap: 12px;
        transition: all 0.3s;
      }
      .nav-link:hover,
      .nav-link.active {
        background-color: #111827;
        color: var(--sidebar-text-hover);
        border-left: 4px solid var(--accent-blue);
      }
      .nav-link i {
        width: 20px;
        text-align: center;
      }

      /* Main Content */
      .main-content {
        margin-left: 250px;
        flex-grow: 1;
        padding: 30px;
        background-color: var(--main-bg);
        width: calc(100% - 250px);
      }

      /* Common Components */
      .card {
        background: var(--card-bg);
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        margin-bottom: 25px;
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e5e7eb;
      }
      .card-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: #374151;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        border: none;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
      }
      .btn-primary {
        background: var(--accent-blue);
        color: white;
      }
      .btn-primary:hover {
        background: #2563eb;
      }
      .btn-danger {
        background: #fee2e2;
        color: #dc2626;
      }
      .btn-danger:hover {
        background: #fecaca;
      }
      .btn-success {
        background: #d1fae5;
        color: #059669;
      }
      .btn-warning {
        background: #fef3c7;
        color: #d97706;
      }
      .btn-secondary {
        background: #e5e7eb;
        color: #374151;
      }
      .btn-sm {
        padding: 5px 12px;
        font-size: 0.8rem;
      }

      .flash-container {
        margin-bottom: 20px;
      }
      .flash {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .flash-success {
        background: #d1fae5;
        color: #065f46;
        border-left: 4px solid #059669;
      }
      .flash-error {
        background: #fee2e2;
        color: #991b1b;
        border-left: 4px solid #ef4444;
      }

      /* Notification Styles */
      .notification-wrapper {
        position: relative;
        display: inline-block;
      }
      .notification-btn {
        background: #f3f4f6;
        color: #6b7280;
        border: none;
        cursor: pointer;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        position: relative;
      }
      .notification-btn:hover {
        background: #e5e7eb;
        color: #374151;
      }

      .notification-badge {
        position: absolute;
        top: -2px;
        right: -2px;
        background: #ef4444;
        color: white;
        font-size: 0.65rem;
        font-weight: bold;
        min-width: 16px;
        height: 16px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0 4px;
        border: 2px solid white;
      }

      .notification-dropdown {
        display: none;
        position: absolute;
        right: 0;
        top: 120%;
        width: 280px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border: 1px solid #e5e7eb;
        z-index: 1000;
        overflow: hidden;
      }
      .notification-wrapper:hover .notification-dropdown {
        display: block;
      }

      .notification-header {
        padding: 12px 15px;
        border-bottom: 1px solid #f3f4f6;
        font-weight: 600;
        color: #374151;
        font-size: 0.9rem;
        background: #f9fafb;
      }
      .notification-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        text-decoration: none;
        color: #4b5563;
        font-size: 0.9rem;
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.1s;
      }
      .notification-item:hover {
        background: #f9fafb;
        color: #111827;
      }
      .notification-item:last-child {
        border-bottom: none;
      }
      .notification-icon {
        width: 28px;
        height: 28px;
        background: #e0f2fe;
        color: #0284c7;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      .notification-empty {
        padding: 30px;
        text-align: center;
        color: #9ca3af;
        font-size: 0.85rem;
      }

      /* Tables */
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th {
        text-align: left;
        padding: 12px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.85rem;
        color: #6b7280;
        text-transform: uppercase;
        font-weight: 600;
      }
      td {
        padding: 15px;
        border-bottom: 1px solid #f3f4f6;
        color: #374151;
        font-size: 0.95rem;
        vertical-align: middle;
      }
      tr:hover {
        background-color: #f9fafb;
      }
    </style>
    
<style>
  .avatar-lg {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 4px solid #e5e7eb;
    object-fit: cover;
  }
  .status-badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  .data-box {
    background: #1f2937;
    color: #a5f3fc;
    padding: 20px;
    border-radius: 8px;
    font-family: monospace;
    white-space: pre-wrap;
    max-height: 400px;
    overflow-y: auto;
  }
</style>

  </head>
  <body>
    <div class="sidebar">
      <div class="logo"><i class="fa-solid fa-hedgehog"></i> Chi Soo Admin</div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a
            href="/"
            class="nav-link "
          >
            <i class="fa-solid fa-gauge"></i> 總覽儀表板
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/houses"
            class="nav-link "
          >
            <i class="fa-solid fa-house"></i> 房源管理
          </a>
        </li>
        <li class="nav-item">
          <a
            href="/reviews"
            class="nav-link "
          >
            <i class="fa-solid fa-comment-dots"></i> 評價管理
          </a>
        </li>
        <li class="nav-item">
          <a
            href="#persona-section"
            class="nav-link "
            onclick="
              if (!location.pathname.endsWith('/'))
                location.href = '/#persona-section';
            "
          >
            <i class="fa-solid fa-masks-theater"></i> 人物誌設定
          </a>
        </li>
      </ul>
      <div
        style="
          padding: 20px;
          font-size: 0.8rem;
          color: #6b7280;
          text-align: center;
        "
      >
        Admin V2.0
      </div>
    </div>

    <div class="main-content">
      <!-- Topbar -->
      <div
        style="
          background: white;
          padding: 15px 30px;
          border-radius: 10px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
          margin-bottom: 30px;
        "
      >
        <div style="font-size: 1.1rem; font-weight: 600; color: #374151">
          
<div style="display: flex; align-items: center; gap: 10px">
  <a href="/" class="btn btn-secondary btn-sm"
    ><i class="fa-solid fa-arrow-left"></i
  ></a>
  <span>使用者檔案</span>
</div>

        </div>

        <!-- Notification Area -->
        <div class="notification-wrapper">
          <button class="notification-btn">
            <i class="fa-regular fa-bell"></i>
            
          </button>

          <div class="notification-dropdown">
            <div class="notification-header">
              待辦事項 (0)
            </div>

            
            <div class="notification-empty">
              <i
                class="fa-regular fa-calendar-check"
                style="font-size: 24px; margin-bottom: 5px; opacity: 0.5"
              ></i>
              <div>目前沒有新的通知</div>
            </div>
            
          </div>
        </div>
      </div>

         
<div class="card">
  <div style="display: flex; align-items: center; gap: 20px">
    
    <img src="https://sprofile.line-scdn.net/0hvzLwNE1BKVVhDjnCh_tXKhFeKj9Cf3BHHmEyM1cHcGNUaW8CH21gM1cLJzJeaz0ETzozM1EHdzFtHV4zf1jVYWY-dGRdN2oLTmpgsw" class="avatar-lg" />
    
    <div>
      <h3 style="font-size: 1.5rem; margin-bottom: 5px">
        楊承逸
      </h3>
      <div style="color: #6b7280; font-family: monospace; margin-bottom: 5px">
        ID: Ub5aca2fe87f1c186afcf95e08bd4f823
      </div>
      <div style="display: flex; gap: 10px; margin-top: 10px">
        <span class="status-badge" style="background: #e0f2fe; color: #0284c7">
          <i class="fa-solid fa-theater-masks"></i> 未分類
        </span>
        
        <span class="status-badge" style="background: #fef3c7; color: #d97706">
          Session: TESTING
        </span>
        
      </div>
    </div>
    <div style="margin-left: auto">
      <form
        action="/clear-user-logs/Ub5aca2fe87f1c186afcf95e08bd4f823"
        method="POST"
        onsubmit="return confirm('確定要清除此使用者的所有 AI 紀錄與標記嗎？');"
      >
        <button type="submit" class="btn btn-danger">
          <i class="fa-solid fa-trash-can"></i> 清除紀錄
        </button>
      </form>
    </div>
  </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 25px">
  <!-- Left: Collected Data -->
  <div>
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <i class="fa-solid fa-database"></i> 已收集資料 (Memory)
        </div>
      </div>
      
      <div style="color: #9ca3af; text-align: center; padding: 20px">
        尚無資料
      </div>
      
    </div>

    <!-- User Weights -->
    <div class="card" style="margin-top: 20px">
      <div class="card-header">
        <div class="card-title">
          <i class="fa-solid fa-scale-balanced"></i> 價值觀權重 (Weights)
        </div>
      </div>
      

      <!-- Radar Chart Container -->
      <div style="position: relative; height: 300px; margin-bottom: 20px">
        <canvas
          id="weightRadarChart"
          data-weights="{"budget": 25, "features": 95, "keyword": 80, "landlord": 55, "location": 85, "type": 35}"
        ></canvas>
      </div>

      <!-- Data Table -->
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>維度</th>
            <th>數值</th>
          </tr>
        </thead>
        <tbody>
          
          <tr>
            <!-- Mapping labels for display -->
            
            <td>房型</td>
            <td style="font-weight: bold; color: #6366f1">35%</td>
          </tr>
          
          <tr>
            <!-- Mapping labels for display -->
            
            <td>預算</td>
            <td style="font-weight: bold; color: #6366f1">25%</td>
          </tr>
          
          <tr>
            <!-- Mapping labels for display -->
            
            <td>關鍵字</td>
            <td style="font-weight: bold; color: #6366f1">80%</td>
          </tr>
          
          <tr>
            <!-- Mapping labels for display -->
            
            <td>設施</td>
            <td style="font-weight: bold; color: #6366f1">95%</td>
          </tr>
          
          <tr>
            <!-- Mapping labels for display -->
            
            <td>房東</td>
            <td style="font-weight: bold; color: #6366f1">55%</td>
          </tr>
          
          <tr>
            <!-- Mapping labels for display -->
            
            <td>地段</td>
            <td style="font-weight: bold; color: #6366f1">85%</td>
          </tr>
          
        </tbody>
      </table>

      <!-- Render Chart Script -->
      <script>
        document.addEventListener("DOMContentLoaded", function () {
          const canvas = document.getElementById("weightRadarChart");
          const weights = JSON.parse(canvas.dataset.weights);

          // Labels mapping
          const labelMap = {
            budget: "預算",
            location: "地段",
            features: "設施",
            landlord: "房東",
            type: "房型",
            keyword: "關鍵字",
          };

          const labels = Object.keys(weights).map((k) => labelMap[k] || k);
          const data = Object.values(weights);

          const ctx = canvas.getContext("2d");
          new Chart(ctx, {
            type: "radar",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "價值觀分佈",
                  data: data,
                  fill: true,
                  backgroundColor: "rgba(99, 102, 241, 0.2)",
                  borderColor: "rgb(99, 102, 241)",
                  pointBackgroundColor: "rgb(99, 102, 241)",
                  pointBorderColor: "#fff",
                  pointHoverBackgroundColor: "#fff",
                  pointHoverBorderColor: "rgb(99, 102, 241)",
                },
              ],
            },
            options: {
              maintainAspectRatio: false,
              elements: {
                line: { borderWidth: 3 },
              },
              scales: {
                r: {
                  angleLines: { display: true },
                  suggestedMin: 0,
                  suggestedMax: 100,
                  ticks: { display: false }, // Hide numbers on axis
                },
              },
              plugins: {
                legend: { display: false },
              },
            },
          });
        });
      </script>

      
    </div>
  </div>

  <!-- Right: AI Logs -->
  <div>
    <div class="card">
      <div class="card-header">
        <div class="card-title">
          <i class="fa-solid fa-brain"></i> AI 思考歷程 (0)
        </div>
      </div>
      
      <div style="padding: 40px; text-align: center; color: #9ca3af">
        <i
          class="fa-solid fa-comment-slash"
          style="font-size: 2rem; margin-bottom: 10px"
        ></i>
        <p>尚無對話紀錄</p>
      </div>
      
    </div>
  </div>
</div>

    </div>

    
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const canvas = document.getElementById("weightRadarChart");
    if (!canvas || !canvas.dataset.weights) return; // No chart or no data, skip

    let weights;
    try {
      weights = JSON.parse(canvas.dataset.weights);
    } catch (e) {
      console.error("Failed to parse weights data", e);
      return;
    }

    const ctx = canvas.getContext("2d");

    // Labels mapping
    const labelMap = {
      budget: "預算",
      location: "地段",
      features: "設施",
      landlord: "房東",
      type: "房型",
      keyword: "關鍵字",
    };

    const labels = Object.keys(weights).map((k) => labelMap[k] || k);
    const data = Object.values(weights);

    // Check if Chart is loaded
    if (typeof Chart === "undefined") {
      console.error("Chart.js library is not loaded");
      return;
    }

    new Chart(ctx, {
      type: "radar",
      data: {
        labels: labels,
        datasets: [
          {
            label: "價值觀分佈",
            data: data,
            fill: true,
            backgroundColor: "rgba(99, 102, 241, 0.2)",
            borderColor: "rgb(99, 102, 241)",
            pointBackgroundColor: "rgb(99, 102, 241)",
            pointBorderColor: "#fff",
            pointHoverBackgroundColor: "#fff",
            pointHoverBorderColor: "rgb(99, 102, 241)",
            borderWidth: 2,
          },
        ],
      },
      options: {
        maintainAspectRatio: false,
        elements: {
          line: { borderWidth: 3 },
        },
        scales: {
          r: {
            angleLines: { display: true },
            min: 0,
            max: 120, // Give some headroom
            grid: {
              color: "#e5e7eb",
            },
            pointLabels: {
              font: {
                size: 14,
                family: "'Segoe UI', sans-serif",
              },
              color: "#374151",
            },
            ticks: {
              display: false,
              count: 5, // fewer grid lines
            },
          },
        },
        plugins: {
          legend: { display: false },
        },
      },
    });
  });
</script>

  </body>
</html>
